@model YeahTVApi.DomainModel.Models.ViewModels.HotelInfoStatistics
@{
    Layout = "/Views/Shared/_DashBoardLayout.cshtml";
    ViewBag.Title = "DashBoard";
}
<style type="text/css">
    .imageIcon {
        width: 36px;
        height: 36px;
        margin: 5px;
    }

    .imageIconTip {
        width: 24px;
        height: 24px;
        margin: 5px;
    }

    .row .col-md-5 h2 {
        margin-top: 0px;
    }

    .pull-left .img-rounded {
        height: 85px;
    }

    .row .h3box {
        margin-bottom: 0px;
        height: 90px;
        float: right;
        margin-right: 20px;
    }

        .row .h3box h3 {
            margin-top: 15px;
        }

    .page-header {
        padding-bottom: 0px;
    }

    .display-none {
        display: none;
    }

    .querytype2 input {
        width: 170px;
    }

    .col-md-2 {
        width: 140px;
        float: left;
    }

    .col-md-3 {
        width: 250px;
        float: left;
    }

        .col-md-3 .col-md-6 {
            float: left;
        }

    .col-md-5 {
        width: 420px;
        float: left;
    }

    .form-inline.pull-right .form-group {
        float: left;
        padding: 5px;
    }

    .clearfix {
        clear: both;
    }

    .col-md-10 div.panel {
        margin-right: 10px;
    }
</style>
<div class="page-content " style="overflow-x: hidden;">
    <div class="page-header">
        <div class="row" style="height: 90px;">
            <div class="pull-left">
                @*<i class="icon-comments"></i>*@
                <img src="@Model.CoreSysBrand.Logo" class="img-rounded" />
            </div>
            <div class="row">
                <div class="col-md-5">
                    <h2>@(Model.CoreSysBrand.BrandName) - @Model.CoreSysHotel.HotelName</h2>
                    <h5>地址：@Model.CoreSysHotel.Address</h5>
                    <h5>电话：@Model.CoreSysHotel.Tel</h5>
                </div>
                <div class="col-md-2 text-center border-radius panel panel-default h3box">
                    <h3>
                        系统已运营
                    </h3>
                    <h3> @((DateTime.Now - Model.CoreSysHotel.CreateTime).Days)天</h3>
                </div>
                <div class="row">
                </div>
            </div>
        </div>
        <div class="row clearfix">
            <hr />
            <div class="col-md-10">
                <div class=" col-md-3 text-center border-radius panel panel-default">
                    <div class="col-md-6">
                        <p>
                            <img src="~/Scripts/assets/dashboard/device.png" class="imageIcon" />
                        </p>
                        <br />
                        <h5 style="padding-top: 5px;">常用机:<strong>@Model.DeviceTraceSeriesCount</strong></h5>
                    </div>
                    <div class="col-md-6">
                        <h1>
                            <strong style="color: black;">@Model.DeviceSeriesTotal</strong>
                        </h1>
                        <p>
                            设备总数
                        </p>
                        <br />
                        <h5 style="padding-top: 5px;">
                            备用机: <strong>@Model.BackUpDeviceSeriesCount</strong>
                        </h5>
                    </div>
                </div>
                <div class="col-md-2 border-radius panel panel-default text-center">
                    <p>
                        <img src="~/Scripts/assets/dashboard/active.png" class="imageIcon" />
                    </p>
                    <h1>
                        <strong style="color: black;">@Model.YesterdayActive</strong>
                    </h1>
                    <h5>昨日最高活跃</h5>
                </div>
                <div class="col-md-2 border-radius panel panel-default text-center">
                    <p>
                        <img src="~/Scripts/assets/dashboard/vod.png" class="imageIcon" />
                    </p>
                    <h1>
                        <strong style="color: black;">￥@Model.YesterdayMovieIncome</strong>
                    </h1>
                    <h5>昨日点播收益</h5>
                </div>
                <div class="col-md-2 border-radius panel panel-default text-center">
                    <p>
                        <img src="~/Scripts/assets/dashboard/module.png" class="imageIcon" />
                    </p>
                    <h1>
                        <strong style="color: black;">@Model.YesterdayUsedTime</strong>
                    </h1>
                    <h5>昨日使用时长</h5>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="row">
            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <img src="~/Scripts/assets/dashboard/active.png" class="imageIconTip" />
                        <span>活跃</span>
                        <div class="form-inline pull-right">
                            <div class="form-group">
                                @Html.TextBox("filterDate", "", new { @class = "input-medium", @value = DateTime.Now.ToDateTimeStr() })
                            </div>
                            <button type="button" class="btn btn-app btn-warning btn-xs queryActive">查 询</button>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div id="main" style="height: 300px">
                            <canvas style="width: 100%;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <img src="~/Scripts/assets/dashboard/module.png" class="imageIconTip" />
                        <span>模块</span>
                        <div class="form-inline pull-right">
                            <div class="form-group">
                                @Html.TextBox("filterDate", "", new { @class = "input-medium", @value = DateTime.Now.ToDateTimeStr() })
                            </div>
                            <button type="button" class="btn btn-app btn-warning btn-xs queryModule">查 询</button>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div id="pie" style="height: 300px">
                            <canvas style="width: 100%;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6" style="width:100%">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <img src="~/Scripts/assets/dashboard/vod.png" class=" imageIconTip" />
                        <span>点播</span>
                        <div class="form-inline pull-right querytype2">
                            <div class="form-group">
                                @Html.TextBox("filterVodDate", "", new { @class = "input-medium querytype2", @value = DateTime.Now.ToDateTimeStr() })
                            </div>
                            <button type="button" class="btn btn-app btn-warning btn-xs queryVod">查 询</button>
                        </div>
                        <div class="form-inline pull-right querytype1 display-none">
                            <div class="form-group">
                                @Html.TextBox("filterWeekDate", "", new { @class = "input-medium querytype1 form-control date-picker", @value = DateTime.Now.ToDateTimeStr() })
                            </div>
                            <button type="button" class="btn btn-app btn-warning btn-xs queryVodOfWeek">查 询</button>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div>
                            <span class="btn btn-xs queryCategory  display-none" querytype="0">点播周排行</span>
                            <span class="btn btn-xs queryCategory  display-none" querytype="1">点播总排行</span>
                            <span class="btn btn-xs  btn-primary queryCategory" querytype="2">vod收益趋势</span>
                            <span class="btn btn-xs queryCategory" querytype="3">vod收益总排行</span>
                        </div>
                        <div id="vod" style="height: 300px">
                            <canvas style="width: 100%;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 display-none">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <img src="~/Scripts/assets/dashboard/tv.png" class="imageIconTip" />
                        <span>电视</span>
                        <div class="form-inline pull-right">
                            <div class="form-group">
                                @Html.TextBox("filterDate", "", new { @class = "input-medium", @value = DateTime.Now.ToDateTimeStr() })
                            </div>
                            <button type="button" class="btn btn-app btn-warning btn-xs queryTV">查 询</button>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div id="video" style="height: 324px">
                            <canvas style="width: 100%;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@section styles {
    <link href="~/Scripts/assets/css/daterangepicker.css" type="text/css" rel="stylesheet" />
    <link href="~/Scripts/assets/css/datepicker.css" type="text/css" rel="stylesheet" />
}
<script src="~/Scripts/dist/echarts.js"></script>
<script src="~/Scripts/assets/js/date-time/moment.min.js"></script>
<script src="~/Scripts/assets/js/date-time/daterangepicker.min.js"></script>
<script src="~/Scripts/assets/js/date-time/bootstrap-datepicker.min.js"></script>
<script src="~/Scripts/divResize.js"></script>
<script type="text/javascript">
    $('input[name=filterDate]').css({ width: "170px" })
       .val('@DateTime.Now.AddDays(-7).ToDateTimeStr(DateFormate.yyyyMMdd)' + ' - ' + '@DateTime.Now.AddDays(-1).ToDateTimeStr(DateFormate.yyyyMMdd)')
       .daterangepicker({
           maxDate: '@DateTime.Now.AddDays(-1).ToDateTimeStr(DateFormate.yyyyMMdd)',
           minDate: '@DateTime.Now.AddDays(-Model.ValidityDays).ToDateTimeStr(DateFormate.yyyyMMdd)',
           startDate: '@DateTime.Now.AddDays(-7).ToDateTimeStr(DateFormate.yyyyMMdd)',
           endDate: '@DateTime.Now.AddDays(-1).ToDateTimeStr(DateFormate.yyyyMMdd)',
           dateLimit: {
               "days": 31
           },
           opens: 'left',
           format: 'YYYY-MM-DD',
           locale: {
               applyLabel: '确定',
               cancelLabel: '取消',
               fromLabel: '起始时间',
               toLabel: '结束时间',
               customRangeLabel: '自定义',
               daysOfWeek: ['日', '一', '二', '三', '四', '五', '六'],
               monthNames: ['一月', '二月', '三月', '四月', '五月', '六月',
                   '七月', '八月', '九月', '十月', '十一月', '十二月'],
               firstDay: 1
           }
       });
    $('input[name=filterVodDate].querytype2').val('@DateTime.Now.AddDays(-30).ToDateTimeStr(DateFormate.yyyyMMdd)' + ' - ' + '@DateTime.Now.AddDays(-1).ToDateTimeStr(DateFormate.yyyyMMdd)')
       .daterangepicker({
           maxDate: '@DateTime.Now.AddDays(-1).ToDateTimeStr(DateFormate.yyyyMMdd)',
           minDate: '@DateTime.Now.AddDays(-Model.ValidityDays).ToDateTimeStr(DateFormate.yyyyMMdd)',
           startDate: '@DateTime.Now.AddDays(-30).ToDateTimeStr(DateFormate.yyyyMMdd)',
           endDate: '@DateTime.Now.AddDays(-1).ToDateTimeStr(DateFormate.yyyyMMdd)',
           opens: 'left',
           format: 'YYYY-MM-DD',
           dateLimit: {
               "days": 31
           },
           locale: {
               applyLabel: '确定',
               cancelLabel: '取消',
               fromLabel: '起始时间',
               toLabel: '结束时间',
               customRangeLabel: '自定义',
               daysOfWeek: ['日', '一', '二', '三', '四', '五', '六'],
               monthNames: ['一月', '二月', '三月', '四月', '五月', '六月',
                   '七月', '八月', '九月', '十月', '十一月', '十二月'],
               firstDay: 1
           }
       });

    //$('div.form-inline.pull-right.querytype2').hide();

    $('input[name=filterWeekDate]')
       .val('@DateTime.Now.AddDays(-1).ToDateTimeStr(DateFormate.yyyyMMdd)')
        .datepicker({
            autoclose: true,
            format: 'yyyy-mm-dd',
            endDate: '@DateTime.Now.AddDays(-1).ToDateTimeStr(DateFormate.yyyyMMdd)',
            language: 'zhcn'

        });


    $(document).ready(function () {

        @if (ViewBag.MoreHotel)
        {
           @: $('.moreHotelIndex').show();
        }
        
         @if (!string.IsNullOrEmpty(@Request.QueryString["hotelId"]))
         {
             @:$('.single-show').show();
         }

        //开机率
        $(document).delegate("button.queryActive", "click",
            function () {
                var date = $(this).siblings().find("input[name=filterDate]").val();
                queryActive(date);
            });

        //模块
        $(document).delegate("button.queryModule", "click",
            function () {
                var date = $(this).siblings().find("input[name=filterDate]").val();
                queryModule(date);
            });

        //VOD收益趋势查询
        $(document).delegate("button.queryVod", "click",
            function () {
                var date = $(this).siblings().find("input[name=filterVodDate]").val();
                queryHotelMovieDailyIncome(date);
            });


        //点播周排行
        $(document).delegate("button.queryVodOfWeek", "click",
            function () {
                var date = $(this).siblings().find("input[name=filterWeekDate]").val();
                queryHotelMovieVodOfWeek(date);
            });

        //点播--类别
        $(document).delegate("span.queryCategory", "click",
            function () {
                $(this).addClass("btn-primary");
                $(this).siblings().removeClass("btn-primary");
                var date;
                $('div.form-inline.pull-right.querytype2').hide();
                $('div.form-inline.pull-right.querytype1').hide();
                switch ($(this).attr("queryType")) {
                    case "0":
                        $('div.form-inline.pull-right.querytype1').show();
                        date = $("input[name=filterWeekDate].querytype1").val();
                        queryHotelMovieVodOfWeek(date);
                        break;
                    case "1":
                        queryHotelMovieVod();
                        break;
                    case "2":
                        $('div.form-inline.pull-right.querytype2').show();
                        date = $("input[name=filterVodDate].querytype2").val();
                        queryHotelMovieDailyIncome(date);
                        break;
                    case "3":
                        queryVod();
                        break;
                }
            });
        //电视
        $(document).delegate("button.queryTV", "click",
            function () {
                var date = $(this).siblings().find("input[name=filterDate]").val();
                queryTV(date);
            });

        $("button.queryActive").click();
        $("button.queryModule").click();
        $("button.queryVod").click();
        //$("button.queryVodOfWeek").click();
        //$("button.queryTV").click();

    });

    function queryHotelMovieDailyIncome(date) {
        // 路径配置
        require.config({
            paths: {
                echarts: '/Scripts/dist/'
            }
        });
        // 使用
        require(
            [
                'echarts',
                'echarts/chart/line', // 使用柱状图就加载bar模块，按需加载
                 'echarts/chart/bar' // 使用柱状图就加载bar模块，按需加载
            ], DrawEChart);
        var myHotelMovieDailyIncomeChart;
        function DrawEChart(ec) {
            // 基于准备好的dom，初始化echarts图表
            myHotelMovieDailyIncomeChart = ec.init(document.getElementById('vod'));
            myHotelMovieDailyIncomeChart.showLoading({
                text: "图表数据正在努力加载..."
            });
            $('#vod').resize(myHotelMovieDailyIncomeChart.resize);

            var options = {
                title: {
                    text: '',
                    subtext: ''
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data: []
                },
                toolbox: {
                    show: true,
                    feature: {
                        borderWidth: 12,
                        saveAsImage: { show: true }
                    }
                },
                calculable: true,
                xAxis: [
                    {
                        type: 'category',
                        boundaryGap: false,
                        data: []
                    }
                ],
                yAxis: [
                    {
                        type: 'value',
                        axisLabel: {
                            formatter: '{value}'
                        }
                    }
                ],
                series: [
                    {
                        name: '收益',
                        type: 'line',
                        data: [],

                        markLine: {
                            data: [
                                { type: 'average', name: '平均值' }
                            ]
                        },
                        itemStyle: {
                            normal: {
                                label: {
                                    show: true,
                                    formatter: '{c}'
                                },
                                labelLine: { show: true }
                            }
                        }
                    }]
            };
            var queryDate = new Array();
            if (date != null) {
                queryDate = date.split(" - ");
                if (queryDate.length != 2) {
                    alert("时间格式错误！");
                    return;
                }
            } else {
                queryDate.push("", "");
            }
            //通过Ajax获取数据
            $.ajax({
                type: "get",
                async: false, //同步执行
                url: ("@Html.Raw(@Url.Action("GetHotelMovieDailyIncome", new { @hotelId = Model.HotelId,@beginDate = "_begin", @endDate = "_end" }))").replace("_begin", queryDate[0]).replace("_end", queryDate[1]),
                dataType: "json", //返回数据形式为json
                success: function (result) {
                    if (result) {
                        options.title.text = "收益趋势";
                        options.title.subtext = queryDate[0] + "~" + queryDate[1];
                        options.xAxis[0].data = result.XAxisList;
                        options.series[0].data = result.SeriesList[0].data;
                        options.legend.data = result.LegendList;
                        myHotelMovieDailyIncomeChart.hideLoading();
                        myHotelMovieDailyIncomeChart.setOption(options);
                        window.onresize = myHotelMovieDailyIncomeChart.resize;
                    }
                },
                error: function (errorMsg) {
                    alert("图表请求数据失败!");
                }
            });
        }

    }

    function queryActive(date) {
        // 路径配置
        require.config({
            paths: {
                echarts: '/Scripts/dist/'
            }
        });
        // 使用
        require(
            [
                'echarts',
                'echarts/chart/line', // 使用柱状图就加载bar模块，按需加载
                 'echarts/chart/bar' // 使用柱状图就加载bar模块，按需加载
            ], DrawEChart);
        var myChart;
        function DrawEChart(ec) {
            // 基于准备好的dom，初始化echarts图表
            myChart = ec.init(document.getElementById('main'));
            myChart.showLoading({
                text: "图表数据正在努力加载..."
            });
            $('#main').resize(myChart.resize);

            var options = {
                title: {
                    text: '',
                    subtext: ''
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data: []
                },
                toolbox: {
                    show: true,
                    feature: {
                        borderWidth: 12,
                        saveAsImage: { show: true }
                    }
                },
                calculable: true,
                xAxis: [
                    {
                        type: 'category',
                        boundaryGap: false,
                        data: []
                    }
                ],
                yAxis: [
                    {
                        type: 'value',
                        axisLabel: {
                            formatter: '{value}'
                        }
                    }
                ],
                series: [
                    {
                        name: '开机率',
                        type: 'line',
                        data: [],

                        markLine: {
                            data: [
                                { type: 'average', name: '平均值' }
                            ]
                        },
                        itemStyle: {
                            normal: {
                                label: {
                                    show: true,
                                    formatter: '{c}%'
                                },
                                labelLine: { show: true }
                            }
                        }
                    }]
            };
            var queryDate = new Array();
            if (date != null) {
                queryDate = date.split(" - ");
                if (queryDate.length != 2) {
                    alert("时间格式错误！");
                    return;
                }
            } else {
                queryDate.push("", "");
            }
            //通过Ajax获取数据
            $.ajax({
                type: "get",
                async: false, //同步执行
                url: ("@Html.Raw(@Url.Action("GetHotelStartPercentage", new { @hotelId = Model.HotelId,@beginDate = "_begin", @endDate="_end" }))").replace("_begin", queryDate[0]).replace("_end", queryDate[1]),
                dataType: "json", //返回数据形式为json
                success: function (result) {
                    if (result) {
                        options.title.text = "开机率";
                        options.title.subtext = queryDate[0] + "~" + queryDate[1];
                        options.xAxis[0].data = result.XAxisList;
                        options.series[0].data = result.SeriesList[0].data;
                        options.legend.data = result.LegendList;
                        myChart.hideLoading();
                        myChart.setOption(options);
                        window.onresize = myChart.resize;
                    }
                },
                error: function (errorMsg) {
                    alert("图表请求数据失败!");
                }
            });
        }

    }
    function queryModule(date) {
        // 路径配置
        require.config({
            paths: {
                echarts: '/Scripts/dist/'
            }
        });

        // 使用
        require(
            [
                'echarts',
                'echarts/chart/bar', // 使用柱状图就加载bar模块，按需加载
                  'echarts/chart/pie' //
            ], DrawEChartModule);
        var myChartModule;
        function DrawEChartModule(ec) {
            // 基于准备好的dom，初始化echarts图表
            myChartModule = ec.init(document.getElementById('pie'));
            myChartModule.showLoading({
                text: "图表数据正在努力加载..."
            });
            $('#pie').resize(myChartModule.resize);

            var options = {
                title: {
                    text: '',
                    subtext: '',
                    x: 'center',
                    y: 'top',
                },
                tooltip: {
                    show: true,
                    trigger: 'item',
                    formatter: "{b} : {c}小时"
                }, toolbox: {
                    show: true,
                    feature: {
                        borderWidth: 12,
                        saveAsImage: { show: true }
                    }
                },
                legend: {
                    orient: 'vertical',
                    x: 'left',
                    data: []
                },
                series: [
                           {
                               name: "模块",
                               type: "pie",
                               radius: '50%',
                               center: ['50%', '55%'],
                               itemStyle: {
                                   normal: {
                                       label: {
                                           show: true,
                                           position: 'top',
                                           textStyle: {
                                               fontSize: 14,

                                           },
                                           formatter: " {b}\n{d}%\n{c}小时"
                                       }
                                   }
                               },
                               data: []
                           }
                ]
            };
            var queryDate = new Array();
            if (date != null) {
                queryDate = date.split(" - ");
                if (queryDate.length != 2) {
                    alert("时间格式错误！");
                    return;
                }
            } else {
                queryDate.push("", "");
            }
            //通过Ajax获取数据
            $.ajax({
                type: "get",
                async: false, //同步执行
                url: ("@Html.Raw(@Url.Action("GetHotelModuleUsedTime", new { @hotelId = Model.HotelId,@beginDate = "_begin", @endDate = "_end" }))").replace("_begin", queryDate[0]).replace("_end", queryDate[1]),
                dataType: "json", //返回数据形式为json
                success: function (result) {
                    if (result) {
                        options.title.text = "使用占比/时长";
                        options.title.subtext = queryDate[0] + "~" + queryDate[1];
                        //options.xAxis[0].data = result.XAxisList;
                        options.series[0].data = result.SeriesList[0].data;
                        options.legend.data = result.LegendList;
                        myChartModule.hideLoading();
                        myChartModule.setOption(options);
                        window.onresize = myChartModule.resize;
                    }
                },
                error: function (errorMsg) {
                    alert("图表请求数据失败!");
                }
            });
        };
    }

    function queryHotelMovieVodOfWeek(date) {
        // 路径配置
        require.config({
            paths: {
                echarts: '/Scripts/dist/'
            }
        });

        // 使用
        require(
            [
                'echarts',
                'echarts/chart/line', // 使用柱状图就加载bar模块，按需加载
                 'echarts/chart/bar' // 使用柱状图就加载bar模块，按需加载
            ], DrawEChartMovieVodOfWeek);


        var myMovieVodOfWeek;

        function DrawEChartMovieVodOfWeek(ec) {

            // 基于准备好的dom，初始化echarts图表
            myMovieVodOfWeek = ec.init(document.getElementById('vod'));
            myMovieVodOfWeek.showLoading({
                text: "图表数据正在努力加载..."
            });
            $('#vod').resize(myMovieVodOfWeek.resize);


            var options = {
                title: {
                    text: '',
                    subtext: ''
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data: []
                },
                toolbox: {
                    show: true,
                    feature: {
                        saveAsImage: { show: true }
                    }
                },
                calculable: true,
                xAxis: [
                    {
                        type: 'value',
                        boundaryGap: [0, 0.01]
                    }
                ],
                yAxis: [
                    {
                        type: 'category',
                        data: []
                    }
                ],
                series: [
                    {
                        name: '点播次数',
                        type: 'bar',
                        sort: 'descending',
                        itemStyle: { normal: { label: { show: true, position: 'right' } } },
                        data: []
                    }]
            };
            var result = date.match(/((^((1[8-9]\d{2})|([2-9]\d{3}))(-)(10|12|0?[13578])(-)(3[01]|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))(-)(11|0?[469])(-)(30|[12][0-9]|0?[1-9])$)|(^((1[8-9]\d{2})|([2-9]\d{3}))(-)(0?2)(-)(2[0-8]|1[0-9]|0?[1-9])$)|(^([2468][048]00)(-)(0?2)(-)(29)$)|(^([3579][26]00)(-)(0?2)(-)(29)$)|(^([1][89][0][48])(-)(0?2)(-)(29)$)|(^([2-9][0-9][0][48])(-)(0?2)(-)(29)$)|(^([1][89][2468][048])(-)(0?2)(-)(29)$)|(^([2-9][0-9][2468][048])(-)(0?2)(-)(29)$)|(^([1][89][13579][26])(-)(0?2)(-)(29)$)|(^([2-9][0-9][13579][26])(-)(0?2)(-)(29)$))/);
            if (result == null) {
                alert("请输入正确的日期格式");
                return false;
            }

            //通过Ajax获取数据
            $.ajax({
                type: "get",
                async: false, //同步执行
                url: ("@Html.Raw(@Url.Action("GetHotelMovieVodOfWeek", new { @hotelId = Model.HotelId, @beginDate = "_begin" }))").replace("_begin", date),
                dataType: "json", //返回数据形式为json
                success: function (result) {
                    if (result) {
                        date = new Date(date);
                        options.title.text = result.Title;
                        options.title.subtext = result.SubTitle;
                        options.yAxis[0].data = result.XAxisList;
                        options.series[0].data = result.SeriesList[0].data;
                        //options.legend.data = result.LegendList;
                        myMovieVodOfWeek.hideLoading();
                        myMovieVodOfWeek.setOption(options);
                        window.onresize = myMovieVodOfWeek.resize;
                    }
                },
                error: function (errorMsg) {
                    alert("图表请求数据失败!");
                }
            });
        }
    }

    function getYearWeek(d) {
        var target = new Date(d.valueOf());
        var dayNr = (d.getDay() + 6) % 7;
        target.setDate(target.getDate() - dayNr + 3);
        var jan4 = new Date(target.getFullYear(), 0, 4);
        var dayDiff = (target - jan4) / 86400000;
        var weekNr = 1 + Math.ceil(dayDiff / 7);
        return weekNr;
    };

    function queryHotelMovieVod() {
        // 路径配置
        require.config({
            paths: {
                echarts: '/Scripts/dist/'
            }
        });

        // 使用
        require(
            [
                'echarts',
                'echarts/chart/line', // 使用柱状图就加载bar模块，按需加载
                 'echarts/chart/bar' // 使用柱状图就加载bar模块，按需加载
            ], DrawEChartHotelMovieVod);


        var myHotelMovieVod;

        function DrawEChartHotelMovieVod(ec) {

            // 基于准备好的dom，初始化echarts图表
            myHotelMovieVod = ec.init(document.getElementById('vod'));
            myHotelMovieVod.showLoading({
                text: "图表数据正在努力加载..."
            });
            $('#vod').resize(myHotelMovieVod.resize);


            var options = {
                title: {
                    text: '',
                    subtext: ''
                },
                tooltip: {
                    trigger: 'axis'
                },
                legend: {
                    data: []
                },
                toolbox: {
                    show: true,
                    feature: {
                        saveAsImage: { show: true }
                    }
                },
                calculable: true,
                xAxis: [
                    {
                        type: 'value',
                        boundaryGap: [0, 0.01]
                    }
                ],
                yAxis: [
                    {
                        type: 'category',
                        data: []
                    }
                ],
                series: [
                    {
                        name: '点播次数',
                        type: 'bar',
                        sort: 'descending',
                        itemStyle: { normal: { label: { show: true, position: 'right' } } },
                        data: []
                    }]
            };

            //通过Ajax获取数据
            $.ajax({
                type: "get",
                async: false, //同步执行
                url: "@Html.Raw(@Url.Action("GetHotelMovieVod", new { @hotelId = Model.HotelId }))",
                dataType: "json", //返回数据形式为json
                success: function (result) {
                    if (result) {
                        options.title.text = "视频点播排行TOP10(次数)";
                        options.yAxis[0].data = result.XAxisList;
                        options.series[0].data = result.SeriesList[0].data;
                        //options.legend.data = result.LegendList;
                        myHotelMovieVod.hideLoading();
                        myHotelMovieVod.setOption(options);
                        window.onresize = myHotelMovieVod.resize;
                    }
                },
                error: function (errorMsg) {
                    alert("图表请求数据失败!");
                }
            });
        }
    }
    function queryVod() {
        // 路径配置
        require.config({
            paths: {
                echarts: '/Scripts/dist/'
            }
        });

        // 使用
        require(
            [
                'echarts',
                'echarts/chart/line', // 使用柱状图就加载bar模块，按需加载
                 'echarts/chart/bar' // 使用柱状图就加载bar模块，按需加载
            ], DrawEChartMovieIncomeRanking);


        var myMovieIncomeRankingChart;

        function DrawEChartMovieIncomeRanking(ec) {

            // 基于准备好的dom，初始化echarts图表
            myMovieIncomeRankingChart = ec.init(document.getElementById('vod'));
            myMovieIncomeRankingChart.showLoading({
                text: "图表数据正在努力加载..."
            });
            $('#vod').resize(myMovieIncomeRankingChart.resize);


            var options = {
                title: {
                    text: '',
                    subtext: ''
                },
                tooltip: {
                    trigger: 'axis'
                },
                //legend: {
                //    data: []
                //},
                toolbox: {
                    show: true,
                    feature: {
                        saveAsImage: { show: true }
                    }
                },
                grid: {
                    x: '90px'
                },
                calculable: true,
                xAxis: [
                    {
                        type: 'value',
                        boundaryGap: [0, 0.01]
                    }
                ],
                yAxis: [
                    {
                        type: 'category',
                        data: []
                    }
                ],
                series: [
                    {
                        name: '收益',
                        type: 'bar',
                        sort: 'descending',
                        itemStyle: { normal: { label: { show: true, position: 'right' } } },
                        data: []
                    }]
            };

            //通过Ajax获取数据
            $.ajax({
                type: "get",
                async: false, //同步执行
                url: "@Html.Raw(@Url.Action("GetHotelMovieIncomeRanking", new { @hotelId = Model.HotelId }))",
                dataType: "json", //返回数据形式为json
                success: function (result) {
                    if (result) {

                        var x = 0;
                        for (var i = 0; i < result.SeriesList[0].data.length; i++) {
                            x += result.SeriesList[0].data[i];
                        }

                        options.title.text = "视频收益排行TOP10    合计：¥" + x.toFixed(2).toString();
                        options.title.subtext = result.SubTitle;

                        options.yAxis[0].data = result.XAxisList;
                        options.series[0].data = result.SeriesList[0].data;
                        //options.legend.data = result.LegendList;
                        myMovieIncomeRankingChart.hideLoading();
                        myMovieIncomeRankingChart.setOption(options);
                        window.onresize = myMovieIncomeRankingChart.resize;
                    }
                },
                error: function (errorMsg) {
                    alert("图表请求数据失败!");
                }
            });
        }
    }



    function queryTV(date) {
        require.config({
            paths: {
                echarts: '/Scripts/dist/'
            }
        });

        // 使用
        require(
            [
                'echarts',
                'echarts/chart/bar' // 使用柱状图就加载bar模块，按需加载
            ], DrawEChartChannelUsedTime);


        var myChannelUsedTimeChart;

        function DrawEChartChannelUsedTime(ec) {

            // 基于准备好的dom，初始化echarts图表
            myChannelUsedTimeChart = ec.init(document.getElementById('video'));
            myChannelUsedTimeChart.showLoading({
                text: "图表数据正在努力加载..."
            });

            $('#video').resize(myChannelUsedTimeChart.resize);

            var options = {
                title: {
                    text: '',
                    subtext: ''
                },
                tooltip: {
                    show: true,
                    formatter: '{c}小时'
                }, toolbox: {
                    show: true,
                    feature: {

                        saveAsImage: { show: true }
                    }
                },
                legend: {
                    data: ['时长']
                },
                xAxis: [
                    {
                        type: 'category',
                        data: [],

                        axisLabel: { rotate: 60 }
                    }
                ],
                yAxis: [
                    {
                        type: 'value'
                    }
                ],
                series: [
                    {
                        name: "时长",
                        type: "bar",
                        itemStyle: { normal: { label: { show: true, position: 'inside' } } },
                        data: []
                    }
                ]
            };

            var queryDate = new Array();
            if (date != null) {
                queryDate = date.split(" - ");
                if (queryDate.length != 2) {
                    alert("时间格式错误！");
                    return;
                }
            } else {
                queryDate.push("", "");
            }

            //通过Ajax获取数据
            $.ajax({
                type: "get",
                async: false, //同步执行
                url: ("@Html.Raw(@Url.Action("GetHotelChannelUsedTime", new { @hotelId = Model.HotelId,@beginDate = "_begin", @endDate = "_end" }))").replace("_begin", queryDate[0]).replace("_end", queryDate[1]),
                dataType: "json", //返回数据形式为json
                success: function (result) {
                    if (result) {
                        options.title.text = "观看时间TOP10";
                        options.xAxis[0].data = result.XAxisList;
                        options.series[0].data = result.SeriesList[0].data;
                        //options.legend.data = result.LegendList;
                        myChannelUsedTimeChart.hideLoading();
                        myChannelUsedTimeChart.setOption(options);
                        window.onresize = myChannelUsedTimeChart.resize;
                    }
                },
                error: function (errorMsg) {
                    alert("图表请求数据失败!");
                }
            });
        };
    }

</script>
